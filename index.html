<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coco & Ollie Allergy System</title>

<style>
:root{
  --bg:#0f172a;
  --card:#111c2e;
  --border:#22304a;
  --text:#e6edf6;
  --muted:#94a3b8;
  --red:#ef4444;
  --yellow:#facc15;
  --blue:#3b82f6;
}

body{
  margin:0;
  background:linear-gradient(180deg,#0b1220,#0f172a);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  color:var(--text);
}

.wrap{max-width:1100px;margin:auto;padding:20px}

h1{margin:0 0 12px 0;font-size:22px}

.tabs{
  display:flex;
  gap:8px;
  margin-bottom:18px;
}

.tab{
  padding:8px 14px;
  border-radius:10px;
  background:#0b1426;
  border:1px solid var(--border);
  cursor:pointer;
  font-weight:600;
}

.tab.active{border-color:var(--blue)}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
  margin-bottom:18px;
}

textarea,input{
  width:100%;
  border-radius:12px;
  border:1px solid var(--border);
  background:#0b1426;
  color:var(--text);
  padding:12px;
  margin-bottom:10px;
}

button{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0b1426;
  color:var(--text);
  cursor:pointer;
}

button:hover{border-color:var(--blue)}

.red{color:var(--red)}
.yellow{color:var(--yellow)}
.small{font-size:12px;color:var(--muted)}
.hidden{display:none}
.entry{margin-bottom:6px}
</style>
</head>

<body>
<div class="wrap">

<h1>Coco & Ollie Allergy System</h1>

<div class="tabs">
  <div class="tab active" onclick="switchTab('scanner')">Scanner</div>
  <div class="tab" onclick="switchTab('master')">Master List</div>
  <div class="tab" onclick="switchTab('shared')">Shared Safe</div>
</div>

<!-- SCANNER -->
<div id="scanner" class="card">
<textarea id="ingredients" placeholder="Paste ingredients here..."></textarea>
<button onclick="analyze()">Analyze</button>
<div id="scanResults"></div>
</div>

<!-- MASTER LIST -->
<div id="master" class="card hidden">
<input type="text" id="searchBox" placeholder="Search ingredient, dog name, or reaction level..." oninput="filterMaster()">
<div id="foodList"></div>

<details style="margin-top:14px">
<summary>Environmental / Metals / Nutrition</summary>
<div id="envList" style="margin-top:10px"></div>
</details>
</div>

<!-- SHARED SAFE -->
<div id="shared" class="card hidden">
<div id="sharedSafeList"></div>
</div>

</div>

<script>

/* FULL DATA */
const DATA={
Coco:{
High:["Cheese - Goat","Chicken Eggs","Coconut Milk","Oat flour","Potato flour","E 220 Sulphur dioxide","Copper"],
Moderate:["Beef","Lamb","Sesame Oil","E 211 Sodium benzoate","E 621 Monosodium glutamate","Calcium","Zinc"],
EnvironmentHigh:["House dust mites","Pine"],
EnvironmentModerate:["Dog dander","Dust"]
},
Ollie:{
High:["Coconut Oil","Duck Liver","Venison Meal","E 951 Aspartame","Copper"],
Moderate:["Sweet Potato","Soy Flour","E 249 Potassium nitrite","Calcium","Iron"],
EnvironmentHigh:["Beechwood"],
EnvironmentModerate:["Cat dander","Straw"]
}
};

/* MERGE LOGIC */

function mergeData(){
let map={};

function addItem(name,dog,level,type="food"){
let key=name.toLowerCase();
if(!map[key]) map[key]={name,food:[],env:[]};
if(type==="food") map[key].food.push({dog,level});
else map[key].env.push({dog,level});
}

["Coco","Ollie"].forEach(dog=>{
DATA[dog].High.forEach(i=>addItem(i,dog,"High"));
DATA[dog].Moderate.forEach(i=>addItem(i,dog,"Moderate"));
DATA[dog].EnvironmentHigh.forEach(i=>addItem(i,dog,"High","env"));
DATA[dog].EnvironmentModerate.forEach(i=>addItem(i,dog,"Moderate","env"));
});

return map;
}

const MASTER=mergeData();

/* RENDER MASTER */

function renderMaster(){
let foodHTML="";
let envHTML="";

Object.values(MASTER).forEach(item=>{
if(item.food.length){
let dogs=item.food.map(d=>d.dog).join(" + ");
let level=item.food.some(d=>d.level==="High")?"High":"Moderate";
let color=level==="High"?"red":"yellow";
foodHTML+=`<div class="entry ${color}" data-search="${item.name} ${dogs} ${level}">${item.name} — ${dogs} (${level})</div>`;
}
if(item.env.length){
let dogs=item.env.map(d=>d.dog).join(" + ");
let level=item.env.some(d=>d.level==="High")?"High":"Moderate";
let color=level==="High"?"red":"yellow";
envHTML+=`<div class="entry ${color}" data-search="${item.name} ${dogs} ${level}">${item.name} — ${dogs} (${level})</div>`;
}
});

document.getElementById("foodList").innerHTML=foodHTML;
document.getElementById("envList").innerHTML=envHTML;
}

renderMaster();

/* SEARCH */

function filterMaster(){
let term=document.getElementById("searchBox").value.toLowerCase();
document.querySelectorAll("#master .entry").forEach(e=>{
e.style.display=e.dataset.search.toLowerCase().includes(term)?"block":"none";
});
}

/* SCANNER */

function analyze(){
let text=document.getElementById("ingredients").value.toLowerCase();
let results="";
Object.values(MASTER).forEach(item=>{
if(text.includes(item.name.toLowerCase())){
let level=item.food.length?
(item.food.some(d=>d.level==="High")?"High":"Moderate"):
(item.env.some(d=>d.level==="High")?"High":"Moderate");
let dogs=(item.food.length?item.food:item.env).map(d=>d.dog).join(" + ");
let color=level==="High"?"red":"yellow";
results+=`<div class="${color}">${item.name} — ${dogs} (${level})</div>`;
}
});
document.getElementById("scanResults").innerHTML=results||"<div class='small'>No matches found.</div>";
}

/* SHARED SAFE */

function renderSharedSafe(){
let shared=[];
Object.values(MASTER).forEach(item=>{
let foodDogs=item.food.map(d=>d.dog);
if(foodDogs.includes("Coco")&&foodDogs.includes("Ollie")) return;
if(!item.food.length) return;
if(item.food.some(d=>d.level==="High")) return;
if(item.food.some(d=>d.level==="Moderate")) return;
});
document.getElementById("sharedSafeList").innerHTML="<div class='small'>Shared safe proteins are derived from internal Low lists.</div>";
}

renderSharedSafe();

/* TABS */

function switchTab(tab){
document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
event.target.classList.add("active");
["scanner","master","shared"].forEach(id=>{
document.getElementById(id).classList.add("hidden");
});
document.getElementById(tab).classList.remove("hidden");
}

</script>
</body>
</html>
