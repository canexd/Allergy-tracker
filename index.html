<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pet Peeves ‚Äî Coco & Ollie</title>

<style>
:root{
  --bg:#0b1424;
  --panel:#121f35;
  --ink:#eaf1ff;
  --muted:rgba(234,241,255,.75);
  --line:rgba(255,255,255,.08);
  --blue:#2f6df6;
  --good:#5cffad;
  --bad:#ff6b6b;
  --caution:#ffd166;
  --radius:16px;
}
*{box-sizing:border-box}
body{
  margin:0;padding:18px;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--ink);
}
.wrap{max-width:980px;margin:auto}
h1{margin:0;font-size:20px}
.sub{font-size:13px;color:var(--muted)}
.tabs{display:flex;gap:8px;margin:16px 0}
.tabBtn{
  background:rgba(255,255,255,.05);
  border:1px solid var(--line);
  color:var(--ink);
  padding:10px 14px;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
}
.tabBtn.active{
  background:var(--blue);
}
.card{
  background:var(--panel);
  border:1px solid var(--line);
  padding:16px;
  border-radius:var(--radius);
  margin-bottom:16px;
}
textarea,input,select{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#0f1b2f;
  color:var(--ink);
}
button{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.06);
  color:var(--ink);
  font-weight:700;
  cursor:pointer;
}
button.primary{background:var(--blue)}
.result{
  margin-top:12px;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--line);
}
.result.good{border-color:var(--good)}
.result.bad{border-color:var(--bad)}
.result.caution{border-color:var(--caution)}
.pill{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:800;
  margin-top:6px;
}
.pill.good{color:var(--good)}
.pill.bad{color:var(--bad)}
.pill.caution{color:var(--caution)}
.savedCard{
  margin-top:12px;
  padding:12px;
  border:1px solid var(--line);
  border-radius:12px;
}
.muted{color:var(--muted);font-size:13px}
</style>
</head>

<body>
<div class="wrap">

<h1>üêæ Pet Peeves ‚Äî Coco & Ollie</h1>
<div class="sub">Scanner ‚Ä¢ Intelligent Meal Planner ‚Ä¢ Grocery ‚Ä¢ Saved Meals</div>

<div class="tabs">
  <button class="tabBtn active" onclick="showTab('scanner')" id="tab-scanner">Scanner</button>
  <button class="tabBtn" onclick="showTab('meal')" id="tab-meal">Meal Planner</button>
  <button class="tabBtn" onclick="showTab('saved')" id="tab-saved">Saved Meals</button>
</div>

<!-- ================= SCANNER ================= -->
<div id="scanner" class="card">
  <h2>üîç Ingredient Scanner</h2>
  <div class="muted">
    Smart matching. Handles plurals, ignores parentheses, detects rice/yogurt variants, scans Food + Additives together.
  </div>

  <textarea id="scanInput" placeholder="Paste ingredients here..."></textarea>

  <div style="margin-top:10px">
    <button class="primary" onclick="scanIngredients()">Scan</button>
    <button onclick="demo()">Demo</button>
    <button onclick="clearScan()">Clear</button>
  </div>

  <div id="scanResults"></div>
</div>

<!-- ================= MEAL ================= -->
<div id="meal" class="card" style="display:none">
  <h2>üç≤ Intelligent Meal Planner</h2>

  <label>Coco weight (lbs)</label>
  <input type="number" id="cocoWeight" value="55">

  <label>Ollie weight (lbs)</label>
  <input type="number" id="ollieWeight" value="65">

  <label>Activity Level</label>
  <select id="activity">
    <option value="2">Sedentary (2%)</option>
    <option value="2.5" selected>Normal (2.5%)</option>
    <option value="3">Active (3%)</option>
    <option value="3.5">Very Active (3.5%)</option>
  </select>

  <label>Meals per day</label>
  <select id="meals">
    <option>1</option>
    <option selected>2</option>
    <option>3</option>
  </select>

  <label>Batch days (1‚Äì7)</label>
  <input type="range" id="days" min="1" max="7" value="7">

  <div style="margin-top:12px">
    <button class="primary" onclick="generateMeal()">Generate Meal</button>
    <button onclick="saveMeal()">Save Meal</button>
  </div>

  <div id="mealOutput"></div>
</div>

<!-- ================= SAVED ================= -->
<div id="saved" class="card" style="display:none">
  <h2>üíæ Saved Meals</h2>
  <div id="savedList"></div>
</div>

</div>

<script>
/* ================================
   REACTIVITY DATA
================================ */

const REACTIVITY = {
  coco:{
    high:["Sweet Potato","Rabbit","Haddock","Paprika","Mozzarella","Carrot"],
    moderate:["Beef","Coconut","Egg Yolk - Chicken","Pepper - green"]
  },
  ollie:{
    high:["Coconut","Onion","Tapioca","Strawberry"],
    moderate:["Anchovy","Sweet Potato","Pepper - green"]
  }
};

/* ================================
   UTILITIES
================================ */

function normalize(str){
  return str.toLowerCase()
    .replace(/\([^)]*\)/g,"")
    .replace(/ingredients:/g,"")
    .replace(/[^a-z0-9\s\-]/g,"")
    .trim();
}

function singular(word){
  if(word.endsWith("ies")) return word.slice(0,-3)+"y";
  if(word.endsWith("s") && !word.endsWith("ss")) return word.slice(0,-1);
  return word;
}

function tokenize(str){
  return normalize(str).split(/\s+/).map(singular);
}

function showTab(tab){
  ["scanner","meal","saved"].forEach(t=>{
    document.getElementById(t).style.display = t===tab?"block":"none";
    document.getElementById("tab-"+t).classList.toggle("active",t===tab);
  });
}

/* ================================
   SCANNER
================================ */

function scanIngredients(){
  const raw = document.getElementById("scanInput").value;
  const items = raw.split(/[\n,]/).map(x=>x.trim()).filter(Boolean);

  let html="";
  items.forEach(item=>{
    const tokens = tokenize(item);
    let cocoHit = null;
    let ollieHit = null;

    for(const t of tokens){
      if(REACTIVITY.coco.high.includes(cap(t))) cocoHit="High";
      if(REACTIVITY.coco.moderate.includes(cap(t))) cocoHit="Moderate";
      if(REACTIVITY.ollie.high.includes(cap(t))) ollieHit="High";
      if(REACTIVITY.ollie.moderate.includes(cap(t))) ollieHit="Moderate";
    }

    if(!cocoHit && !ollieHit){
      html += `<div class="result good">‚úÖ ${item}<br><span class="pill good">Safe for both</span></div>`;
    } else {
      html += `<div class="result bad">‚ö†Ô∏è ${item}<br>`;
      if(cocoHit) html+=`<span class="pill ${cocoHit==="High"?"bad":"caution"}">Coco: ${cocoHit}</span> `;
      if(ollieHit) html+=`<span class="pill ${ollieHit==="High"?"bad":"caution"}">Ollie: ${ollieHit}</span>`;
      html+=`</div>`;
    }
  });

  document.getElementById("scanResults").innerHTML=html;
}

function cap(s){
  return s.charAt(0).toUpperCase()+s.slice(1);
}

function demo(){
  document.getElementById("scanInput").value =
`Chicken
Beef
Carrots
Sweet Potato
Pepper - green
E 221 sodium sulphite`;
  scanIngredients();
}

function clearScan(){
  document.getElementById("scanResults").innerHTML="";
  document.getElementById("scanInput").value="";
}

/* ================================
   MEAL PLANNER
================================ */

function generateMeal(){
  const coco = parseFloat(document.getElementById("cocoWeight").value);
  const ollie = parseFloat(document.getElementById("ollieWeight").value);
  const pct = parseFloat(document.getElementById("activity").value);
  const meals = parseInt(document.getElementById("meals").value);
  const days = parseInt(document.getElementById("days").value);

  const cocoDaily = coco*pct/100*16;
  const ollieDaily = ollie*pct/100*16;
  const totalBatch = (cocoDaily+ollieDaily)*days;

  const perMealCoco = cocoDaily/meals;
  const perMealOllie = ollieDaily/meals;

  const html = `
<div class="result good">
Daily Feeding:<br>
Coco: ${cocoDaily.toFixed(1)} oz (${(cocoDaily/4).toFixed(2)} cups)<br>
Ollie: ${ollieDaily.toFixed(1)} oz (${(ollieDaily/4).toFixed(2)} cups)<br><br>

Per Meal:<br>
Coco: ${perMealCoco.toFixed(1)} oz (${(perMealCoco/4).toFixed(2)} cups)<br>
Ollie: ${perMealOllie.toFixed(1)} oz (${(perMealOllie/4).toFixed(2)} cups)<br><br>

Batch Total (${days} days): ${(totalBatch/16).toFixed(2)} lbs
</div>
`;

  document.getElementById("mealOutput").innerHTML=html;

  window.lastMeal = html;
}

/* ================================
   SAVE SYSTEM
================================ */

function saveMeal(){
  if(!window.lastMeal) return alert("Generate meal first.");
  let saved = JSON.parse(localStorage.getItem("savedMeals")||"[]");
  saved.unshift(window.lastMeal);
  localStorage.setItem("savedMeals",JSON.stringify(saved));
  renderSaved();
}

function renderSaved(){
  let saved = JSON.parse(localStorage.getItem("savedMeals")||"[]");
  let html="";
  saved.forEach((m,i)=>{
    html+=`<div class="savedCard">${m}<br>
    <button onclick="deleteMeal(${i})">Delete</button></div>`;
  });
  document.getElementById("savedList").innerHTML=html||"No saved meals.";
}

function deleteMeal(i){
  let saved = JSON.parse(localStorage.getItem("savedMeals")||"[]");
  saved.splice(i,1);
  localStorage.setItem("savedMeals",JSON.stringify(saved));
  renderSaved();
}

renderSaved();
</script>
</body>
</html>
