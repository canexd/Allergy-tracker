<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coco & Ollie Smart Allergy System</title>

<style>
:root{
  --bg:#0f172a;
  --card:#111c2e;
  --border:#22304a;
  --text:#e6edf6;
  --muted:#94a3b8;
  --red:#ef4444;
  --yellow:#facc15;
  --green:#22c55e;
  --blue:#3b82f6;
}

body{
  margin:0;
  background:linear-gradient(180deg,#0b1220,#0f172a);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  color:var(--text);
}

.wrap{max-width:1100px;margin:auto;padding:20px}

h1{margin:0 0 6px 0;font-size:22px}
.sub{color:var(--muted);font-size:13px;margin-bottom:20px}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
  margin-bottom:18px;
}

textarea{
  width:100%;
  min-height:120px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#0b1426;
  color:var(--text);
  padding:14px;
  margin-bottom:10px;
}

button{
  margin-right:8px;
  margin-top:8px;
  padding:10px 14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#0b1426;
  color:var(--text);
  cursor:pointer;
  font-weight:600;
}

button:hover{border-color:var(--blue)}

.resultBox{
  border-radius:12px;
  padding:14px;
  margin-bottom:12px;
  background:#0b1426;
  border:1px solid var(--border);
}

.red{color:var(--red)}
.yellow{color:var(--yellow)}
.green{color:var(--green)}
.blue{color:var(--blue)}

.banner{
  padding:10px;
  border-radius:12px;
  margin-bottom:10px;
  font-weight:700;
}

.banner.red{background:rgba(239,68,68,.15)}
.banner.yellow{background:rgba(250,204,21,.15)}
.banner.green{background:rgba(34,197,94,.15)}

.grid2{
  display:grid;
  grid-template-columns:1fr;
  gap:14px;
}

@media(min-width:800px){
  .grid2{grid-template-columns:1fr 1fr}
}

.small{font-size:12px;color:var(--muted)}
.historyItem{
  border-bottom:1px solid var(--border);
  padding:6px 0;
  font-size:12px;
}
</style>
</head>

<body>
<div class="wrap">

<h1>Coco & Ollie Smart Allergy System</h1>
<div class="sub">
üî¥ High = Avoid | üü° Moderate = Caution | üü¢ Low = Safe  
(Default shows High + Moderate only)
</div>

<div class="card">
<textarea id="ingredients" placeholder="Paste ingredients here..."></textarea>
<button onclick="analyze()">Analyze</button>
<button onclick="demo()">Demo</button>
<button onclick="clearBox()">Clear</button>
<button onclick="toggleStrict()">Toggle Strict Mode</button>
<button onclick="toggleSafe()">Toggle Safe Matches</button>
</div>

<div class="card" id="results"></div>

<div class="card">
<h3>Shared Safe Protein Suggestions</h3>
<div id="safeSuggestions"></div>
</div>

<div class="card">
<h3>Food Comparison Tool</h3>
<div class="grid2">
<textarea id="food1" placeholder="Paste Food A ingredients..."></textarea>
<textarea id="food2" placeholder="Paste Food B ingredients..."></textarea>
</div>
<button onclick="compareFoods()">Compare Foods</button>
<div id="compareResults"></div>
</div>

<div class="card">
<h3>Scan History</h3>
<div id="historyLog"></div>
</div>

</div>

<script>

let showSafe=false;
let strictMode=false;

/* === FULL DATA SET === */

const DATA={
Coco:{
High:["Cheese - Goat","Chicken Eggs","Coconut Milk","Oat flour","Potato flour","E 220 Sulphur dioxide","Copper"],
Moderate:["Beef","Lamb","Sesame Oil","E 211 Sodium benzoate","E 621 Monosodium glutamate","Calcium","Zinc"],
Low:["Chicken","Turkey","Salmon","Rice","Carrot","Sweet Potato"]
},
Ollie:{
High:["Coconut Oil","Duck Liver","Venison Meal","E 951 Aspartame","Copper"],
Moderate:["Sweet Potato","Soy Flour","E 249 Potassium nitrite","Calcium","Iron"],
Low:["Beef","Chicken","Turkey","Rice","Carrot","Pumpkin"]
}
};

function normalize(s){return s.toLowerCase();}

function match(list,text){
return list.filter(i=>text.includes(i.toLowerCase()));
}

function evaluate(text){
let overall="green";
let cocoHigh=match(DATA.Coco.High,text);
let cocoMod=match(DATA.Coco.Moderate,text);
let ollieHigh=match(DATA.Ollie.High,text);
let ollieMod=match(DATA.Ollie.Moderate,text);

if(cocoHigh.length||ollieHigh.length) overall="red";
else if(cocoMod.length||ollieMod.length) overall="yellow";

return {overall,cocoHigh,cocoMod,ollieHigh,ollieMod};
}

function analyze(){
let text=normalize(document.getElementById("ingredients").value);
let result=evaluate(text);

let bannerText=
result.overall==="red"?"‚ùå AVOID ‚Äì High reaction detected":
result.overall==="yellow"?"‚ö†Ô∏è CAUTION ‚Äì Moderate reactions present":
"‚úÖ SAFE ‚Äì No High or Moderate matches";

document.getElementById("results").innerHTML=`
<div class="banner ${result.overall}">${bannerText}</div>
<div class="resultBox">
<b>Coco</b><br>
${result.cocoHigh.map(i=>`<div class="red">üî¥ ${i}</div>`).join("")}
${result.cocoMod.map(i=>`<div class="yellow">üü° ${i}</div>`).join("")}
${showSafe?match(DATA.Coco.Low,text).map(i=>`<div class="green">üü¢ ${i}</div>`).join(""):""}
</div>
<div class="resultBox">
<b>Ollie</b><br>
${result.ollieHigh.map(i=>`<div class="red">üî¥ ${i}</div>`).join("")}
${result.ollieMod.map(i=>`<div class="yellow">üü° ${i}</div>`).join("")}
${showSafe?match(DATA.Ollie.Low,text).map(i=>`<div class="green">üü¢ ${i}</div>`).join(""):""}
</div>
`;

generateSafeSuggestions();
addToHistory(text,result.overall);
}

function generateSafeSuggestions(){
let safeShared=DATA.Coco.Low.filter(item =>
DATA.Ollie.Low.includes(item) &&
!DATA.Coco.Moderate.includes(item) &&
!DATA.Ollie.Moderate.includes(item) &&
!DATA.Coco.High.includes(item) &&
!DATA.Ollie.High.includes(item)
);

document.getElementById("safeSuggestions").innerHTML=
safeShared.length?
safeShared.map(i=>`<div class="green">üü¢ ${i}</div>`).join("")
:"<div class='small'>No shared fully safe proteins identified.</div>";
}

function compareFoods(){
let f1=evaluate(normalize(document.getElementById("food1").value));
let f2=evaluate(normalize(document.getElementById("food2").value));

document.getElementById("compareResults").innerHTML=`
<div class="resultBox">
<b>Food A:</b> ${f1.overall.toUpperCase()}
</div>
<div class="resultBox">
<b>Food B:</b> ${f2.overall.toUpperCase()}
</div>
`;
}

function addToHistory(text,status){
let history=JSON.parse(localStorage.getItem("history")||"[]");
history.unshift({date:new Date().toLocaleString(),status});
localStorage.setItem("history",JSON.stringify(history.slice(0,20)));
renderHistory();
}

function renderHistory(){
let history=JSON.parse(localStorage.getItem("history")||"[]");
document.getElementById("historyLog").innerHTML=
history.map(h=>`<div class="historyItem">${h.date} ‚Äì ${h.status}</div>`).join("");
}

function toggleSafe(){showSafe=!showSafe;analyze();}
function toggleStrict(){strictMode=!strictMode;}
function demo(){
document.getElementById("ingredients").value=
"Ingredients: beef, coconut oil, rice, chicken eggs, sweet potato, carrot.";
}
function clearBox(){
document.getElementById("ingredients").value="";
document.getElementById("results").innerHTML="";
}

renderHistory();
</script>
</body>
</html>
