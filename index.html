<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Allergy Checker (Coco + Ollie)</title>
  <style>
    :root { --bg:#0b0f17; --card:#111828; --muted:#9aa4b2; --text:#e6eaf0; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444; --line:#243044; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#070a10,#0b0f17); color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .title{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
    h1{font-size:18px;margin:0}
    .sub{color:var(--muted);font-size:13px;margin-top:6px;line-height:1.35}
    .row{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
    @media (min-width: 860px){ .row{grid-template-columns: 1.1fr .9fr;} }
    .card{background:rgba(17,24,40,.92); border:1px solid var(--line); border-radius:14px; padding:14px}
    textarea{width:100%;min-height:160px;border-radius:12px;border:1px solid var(--line); background:#0b1220;color:var(--text);padding:12px;font-size:14px;line-height:1.35;outline:none}
    textarea:focus{border-color:#3b82f6}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{border:1px solid var(--line); background:#0b1220; color:var(--text); padding:10px 12px; border-radius:12px; font-weight:600; cursor:pointer}
    button:hover{border-color:#3b82f6}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line); background:#0b1220; padding:8px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    .dot{width:9px;height:9px;border-radius:50%}
    .dot.good{background:var(--good)} .dot.warn{background:var(--warn)} .dot.bad{background:var(--bad)}
    .grid2{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width: 640px){ .grid2{grid-template-columns:1fr 1fr;} }
    .sectionTitle{display:flex;align-items:center;justify-content:space-between;margin:0 0 8px 0}
    .dogName{font-size:15px;margin:0}
    .badge{font-size:12px;color:var(--muted)}
    .box{border:1px solid var(--line);border-radius:12px;padding:10px;background:#0b1220}
    .label{font-size:12px;color:var(--muted);margin:0 0 6px 0}
    ul{margin:8px 0 0 18px;padding:0}
    li{margin:4px 0;word-break:break-word}
    .empty{color:var(--muted);font-size:13px}
    details{border:1px dashed var(--line);border-radius:12px;padding:10px;background:rgba(11,18,32,.55)}
    summary{cursor:pointer;color:var(--text);font-weight:700}
    .small{font-size:12px;color:var(--muted);line-height:1.35}
    .k{color:#c7d2fe}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">
      <div>
        <h1>Allergy / Sensitivity Ingredient Checker</h1>
        <div class="sub">
          Paste ingredients from dog food/treats. You’ll get a per-dog summary:
          <span class="k">SAFE</span>, <span class="k">CAUTION (Moderate)</span>, <span class="k">AVOID (High)</span>.
        </div>
      </div>
      <div class="pill"><span class="dot good"></span>SAFE &nbsp; <span class="dot warn"></span>CAUTION &nbsp; <span class="dot bad"></span>AVOID</div>
    </div>

    <div class="row">
      <div class="card">
        <div class="sectionTitle">
          <div>
            <div style="font-weight:800;">Paste Ingredients</div>
            <div class="small">Tip: copy the whole ingredient line (commas are fine).</div>
          </div>
        </div>
        <textarea id="ingredients" placeholder="Example: chicken, sweet potato, glycerin, natural flavors, turmeric..."></textarea>
        <div class="btns">
          <button id="run">Check Coco + Ollie</button>
          <button id="clear">Clear</button>
          <button id="demo">Paste Demo Ingredients</button>
        </div>

        <div style="margin-top:12px" class="small">
          Matching is “best effort” text matching. If a brand uses weird names, paste the full label and it usually catches it.
        </div>
      </div>

      <div class="card">
        <div class="sectionTitle">
          <div style="font-weight:800;">Results</div>
          <div class="badge" id="status">Waiting…</div>
        </div>

        <div class="grid2">
          <div class="box" id="cocoBox">
            <div class="sectionTitle">
              <h3 class="dogName">Coco</h3>
              <span class="badge" id="cocoSummary">—</span>
            </div>
            <div class="label"><span class="dot bad"></span> AVOID (High)</div>
            <ul id="cocoHigh"></ul>
            <div class="label" style="margin-top:10px;"><span class="dot warn"></span> CAUTION (Moderate)</div>
            <ul id="cocoMod"></ul>
          </div>

          <div class="box" id="ollieBox">
            <div class="sectionTitle">
              <h3 class="dogName">Ollie</h3>
              <span class="badge" id="ollieSummary">—</span>
            </div>
            <div class="label"><span class="dot bad"></span> AVOID (High)</div>
            <ul id="ollieHigh"></ul>
            <div class="label" style="margin-top:10px;"><span class="dot warn"></span> CAUTION (Moderate)</div>
            <ul id="ollieMod"></ul>
          </div>
        </div>

        <div style="margin-top:12px" class="small">
          If you want this stricter (only exact matches) or looser (more fuzzy matching), tell me — it’s a 2-minute tweak.
        </div>
      </div>
    </div>

    <div class="card">
      <details>
        <summary>Show the stored sensitivity lists (so the page stays clean)</summary>
        <div class="small" style="margin-top:10px">
          These are the High/Moderate items from your reports, used for matching.
        </div>
        <pre id="lists" style="white-space:pre-wrap;word-break:break-word;color:var(--muted);margin:10px 0 0 0;"></pre>
      </details>
    </div>
  </div>

<script>
/**
 * Data from your reports (High/Moderate only).
 * Food/Additives/Environmental/Nutrition/Metals are all included as match targets.
 *
 * Coco:
 * - Food overview 0
 * - Additives overview 1
 * - Environmental overview 2
 * - Nutrition overview 3
 * - Metals overview 4
 *
 * Ollie:
 * - Food overview 5
 * - Additives overview 6
 * - Environmental overview 7
 * - Nutrition overview 8
 * - Metals overview 9
 */

const DOGS = {
  Coco: {
    High: [
      // Food (High)
      "Cheese - Goat","Chicken Eggs","Chives","Clove","Coconut Milk","Coffee Beans","Groundnut oil",
      "Linseed (flax)","Marshmallow root","Mushroom - white button","Oat flour","Pasta - white",
      "Potato flour","Sunflower Spread",
      // Additives (High)
      "E 150 b Caustic Sulphite Caramel (brown coloring)","E 220 Sulphur dioxide (preservative)",
      "E 225 Potassium sulphite (preservative)","E 233 Thiabendazole (preservative/fungicide)",
      "E 236 Formic acid (preservative)","E 317 Erythorbic acid (antioxidant)",
      "E 518 Magnesium sulphate (firming agent)","E 620 Glutamic acid (flavour enhancer)",
      "E 635 Disodium 5'-ribonucleotides (flavour enhancer)","E 905 c Paraffin wax (coating agent)",
      "E 913 Lanolin (coating agent)","Myrrh",
      // Environmental (High)
      "House dust mites","Pine","Polyester","Willow",
      // Nutrition (Highly outside range)
      "Copper","Iron","Magnesium","Manganese","Potassium",
      // Metals (High)
      "Cobalt","Copper"
    ],
    Moderate: [
      // Food (Moderate)
      "Cabbage","Ground Yellow Corn","Lamb","Pumpkin Seeds","Sesame Oil",
      // Additives (Moderate)
      "Artichoke leaf extract","Astragalus Root","Carotenoids","Chicory Root Extract","E 211 Sodium benzoate (preservative)",
      "E 212 Potassium benzoate (preservative)","E 252 Potassium nitrate (preservative)","E 320 Butylated hydroxyanisole (BHA) (antioxidant)",
      "E 410 Locust bean gum (thickener)","E 420 Sorbitol (sweetener)","E 621 Monosodium glutamate (flavour enhancer)",
      "E 955 Sucralose (sweetener)","E 962 Aspartame-acesulfame salt (sweetener)","Formalin",
      // Environmental (Moderate)
      "Aspergillus fumigatus","Ash","Beechwood","Cat dander","Chicken feathers","Dandelion","Dog dander","Dust",
      "Horse hair","Orchard grass","Plantain","Sheep wool","Straw","Wheat pollen",
      // Nutrition (Moderately outside range)
      "Calcium","Cobalt","Lysine","Sodium","Zinc",
      // Metals (Moderate)
      "Aluminium","Antimony","Cadmium","Chlorine","Chromium","Gold","Lead","Manganese","Mercury",
      "Molybdenum","Nickel","Niobium","Palladium","Rubidium","Tin"
    ]
  },

  Ollie: {
    High: [
      // Food (High)
      "Avocado oil","Boar","Buttermilk","Canola Meal","Coconut","Coconut Oil","Crab","Duck Liver","Noodles - wheat",
      "Papaya","Parmesan","Prawn","Sage","Strawberry","Tapioca","Venison Meal",
      // Additives (High)
      "E 141 Copper complexes of chlorophyll (green coloring)","E 150 d Sulphite Ammonia Caramel (brown coloring)",
      "E 160 e Beta-apo-8'-carotenal (orange pigment)","E 162 Beetroot red (natural red coloring)",
      "E 218 Methyl p-hydroxybenzoate (preservative)","E 242 Dimethyl dicarbonate (sterilizing agent)",
      "E 260 Acetic acid (preservative)","E 263 Calcium acetate (acidity regulator)","E 270 Lactic acid (preservative)",
      "E 335 Sodium tartrate (acidity regulator)","E 472 d Tartaric acid esters of mono- and diglycerides (emulsifier)",
      "E 473 Sucrose esters of fatty acids (emulsifier)","E 477 Propylene glycol esters of fatty acids (emulsifier)",
      "E 522 Aluminium potassium sulphate (stabiliser)","E 541 Sodium aluminium phosphate (raising agent)",
      "E 630 Inosinic acid (flavour enhancer)","E 941 Nitrogen (packing gas)","E 951 Aspartame (sweetener)",
      "Formic acid","Pepsin","Tartaric acid",
      // Environmental (High)
      "Ammonia","Beechwood","Birchwood","Chicken feathers","Dog dander","Dandelion",
      // Nutrition (Highly outside range)
      "Copper","Manganese","Phosphorus","Sodium","Zinc",
      // Metals (High)
      "Copper","Palladium","Rubidium"
    ],
    Moderate: [
      // Food (Moderate)
      "Anchovy","Catfish","Cheese - Cottage","Chicken Heart","Condensed milk","Cream","Egg White - Chicken",
      "Emmer wheat","Farina secalis cerealis","Ginkgo biloba","Greens (Collard)","Lamb Liver","Liver - ox",
      "Milkweed","Onion","Pepper - green","Pheasant Gizzard","Pigeon","Raisin","Skate","Soy Flour",
      "Sweet Potato","Tilefish","Winkles",
      // Additives (Moderate)
      "E 150 c Ammonia Caramel (brown coloring)","E 1520 Propylene glycol","E 249 Potassium nitrite (curing agent)",
      "E 284 Boric acid (preservative)","E 312 Dodecyl gallate (antioxidant)","E 334 Tartaric acid (acidity regulator)",
      "E 353 Metatartaric acid (acidity regulator)","E 354 Calcium tartrate (acidity regulator)",
      "E 472 e Mono- and diacetyltartaric acid esters of mono- and diglycerides (emulsifier)",
      "E 476 Polyglycerol polyricinoleate (emulsifier)","E 554 Sodium aluminosilicate (anti-caking agent)",
      "E 621 Monosodium glutamate (flavour enhancer)","E 634 Calcium 5'-ribonucleotides (flavour enhancer)",
      "E 902 Candelilla wax (coating agent)","E 903 Carnauba wax (coating agent)","Formalin",
      // Environmental (Moderate)
      "Aspergillus fumigatus","Ash","Cat dander","Cladosporium herbarum","Cotton","Dust","Horse hair",
      "Orchard grass","Pine","Polyester","Sheep wool","Straw","Tree pollen","Wheat pollen","Willow",
      // Nutrition (Moderately outside range)
      "Calcium","Iron","Magnesium","Potassium",
      // Metals (Moderate)
      "Aluminium","Chromium","Cobalt","Gold","Manganese","Mercury","Molybdenum","Niobium","Tin"
    ]
  }
};

function norm(s){
  return (s || "")
    .toLowerCase()
    .replace(/\u00a0/g," ")
    .replace(/[\(\)\[\]\{\}]/g," ")
    .replace(/[^\w\s\.\-']/g," ")
    .replace(/\s+/g," ")
    .trim();
}

// Build “match keys” so E-numbers match even if label formats differ (e.g. "E260", "E 260")
function buildMatchers(items){
  return items.map(item => {
    const n = norm(item);

    // E-number support
    const em = n.match(/\be\s*([0-9]{3,4})\b/);
    const eNum = em ? em[1] : null;

    // Use multiple match keys:
    const keys = new Set();
    keys.add(n);
    if(eNum){
      keys.add(`e ${eNum}`);
      keys.add(`e${eNum}`);
      keys.add(`e-${eNum}`);
    }

    // Also add the plain-name part after the E number if present
    // Example: "E 260 Acetic acid (preservative)" -> "acetic acid"
    if(eNum){
      const stripped = n.replace(/\be\s*[0-9]{3,4}\b/g," ").replace(/\s+/g," ").trim();
      if(stripped.length >= 4) keys.add(stripped);
    }

    return { label:item, keys:[...keys] };
  });
}

const MATCHERS = {
  Coco: { High: buildMatchers(DOGS.Coco.High), Moderate: buildMatchers(DOGS.Coco.Moderate) },
  Ollie:{ High: buildMatchers(DOGS.Ollie.High), Moderate: buildMatchers(DOGS.Ollie.Moderate) }
};

function findMatches(pastedText, dogName){
  const t = norm(pastedText);
  const out = { high:[], mod:[] };

  for(const entry of MATCHERS[dogName].High){
    if(entry.keys.some(k => k && t.includes(k))) out.high.push(entry.label);
  }
  for(const entry of MATCHERS[dogName].Moderate){
    if(entry.keys.some(k => k && t.includes(k))) out.mod.push(entry.label);
  }

  // de-dupe (just in case multiple keys hit)
  out.high = [...new Set(out.high)];
  out.mod  = [...new Set(out.mod)].filter(x => !out.high.includes(x));

  return out;
}

function setList(ul, items){
  ul.innerHTML = "";
  if(!items.length){
    const d = document.createElement("div");
    d.className="empty";
    d.textContent="None found.";
    ul.appendChild(d);
    return;
  }
  for(const it of items){
    const li = document.createElement("li");
    li.textContent = it;
    ul.appendChild(li);
  }
}

function summarize(highCount, modCount){
  if(highCount>0) return `AVOID: ${highCount} found`;
  if(modCount>0) return `CAUTION: ${modCount} found`;
  return `SAFE: no matches`;
}

function run(){
  const txt = document.getElementById("ingredients").value || "";
  const status = document.getElementById("status");
  status.textContent = "Checking…";

  const coco = findMatches(txt, "Coco");
  const ollie = findMatches(txt, "Ollie");

  setList(document.getElementById("cocoHigh"), coco.high);
  setList(document.getElementById("cocoMod"), coco.mod);
  setList(document.getElementById("ollieHigh"), ollie.high);
  setList(document.getElementById("ollieMod"), ollie.mod);

  document.getElementById("cocoSummary").textContent = summarize(coco.high.length, coco.mod.length);
  document.getElementById("ollieSummary").textContent = summarize(ollie.high.length, ollie.mod.length);

  status.textContent = "Done";
}

document.getElementById("run").addEventListener("click", run);
document.getElementById("clear").addEventListener("click", () => {
  document.getElementById("ingredients").value = "";
  document.getElementById("status").textContent = "Waiting…";
  ["cocoHigh","cocoMod","ollieHigh","ollieMod"].forEach(id => document.getElementById(id).innerHTML="");
  document.getElementById("cocoSummary").textContent="—";
  document.getElementById("ollieSummary").textContent="—";
});
document.getElementById("demo").addEventListener("click", () => {
  document.getElementById("ingredients").value =
`Ingredients: chicken, sweet potato, coconut oil, glycerin, citric acid, natural flavors, paprika extract, lactic acid, sodium benzoate, rosemary extract.`;
  run();
});

// Populate the hidden list view (kept collapsed to save space)
document.getElementById("lists").textContent =
JSON.stringify(DOGS, null, 2);
</script>
</body>
</html>
