<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coco & Ollie Food System</title>

<style>
body{
margin:0;
font-family:system-ui;
background:#071225;
color:#e6eefc;
}
.wrap{max-width:1000px;margin:auto;padding:16px}
.card{
background:#0f2344;
padding:16px;
border-radius:14px;
margin:16px 0;
}
button{
background:#2e6df6;
color:white;
border:none;
padding:10px 14px;
border-radius:10px;
cursor:pointer;
}
input,textarea,select{
width:100%;
padding:8px;
margin-top:6px;
background:#0b1b33;
border:1px solid #1c335f;
color:white;
border-radius:8px;
}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab-btn{
background:#10264d;
padding:6px 10px;
border-radius:8px;
cursor:pointer;
}
.tab-btn.active{background:#2e6df6}
.hidden{display:none}
.red{color:#ff5e5e}
.yellow{color:#ffd65e}
.green{color:#57e389}
.small{font-size:12px;color:#9fb2d9}
.sep{height:1px;background:#1c335f;margin:12px 0}
</style>
</head>

<body>
<div class="wrap">

<h2>Coco & Ollie Food System</h2>

<div class="tabs">
<div class="tab-btn active" onclick="showTab('scanner')">Scanner</div>
<div class="tab-btn" onclick="showTab('master')">Master</div>
<div class="tab-btn" onclick="showTab('shared')">Shared Safe</div>
<div class="tab-btn" onclick="showTab('meal')">Meal Planner</div>
<div class="tab-btn" onclick="showTab('saved')">Saved</div>
<div class="tab-btn" onclick="showTab('history')">History</div>
</div>

<script>

const DATA = {

  coco: {
    high: [
      "Canola Oil","Chia Seeds","Clove","Haddock","Herring",
      "Mozzarella","Paprika","Peach","Rabbit","Rabbit Heart",
      "Rabbit Liver","Rapeseed oil","Sugar (brown)",
      "Sweet Potato","Tahini"
    ],
    moderate: [
      "Ammonium Laureth Sulfate","Beef","Bilberry",
      "Cheese - Cheddar","Chlorella","Coconut","Cornflakes",
      "Egg Yolk - Chicken","Egg Yolk - Duck","Hare",
      "Iceberg lettuce","Lemon","Pecan nut","Pepper - green",
      "Psyllium Seed Husk","Strawberry","Turnip","Winkles"
    ]
  },

  ollie: {
    high: [
      "Avocado oil","Boar","Buttermilk","Canola Meal","Coconut",
      "Coconut Oil","Crab","Duck Liver","Noodles - wheat",
      "Papaya","Parmesan","Prawn","Sage","Strawberry",
      "Tapioca","Venison Meal"
    ],
    moderate: [
      "Anchovy","Catfish","Cheese - Cottage","Chicken Heart",
      "Condensed milk","Cream","Egg White - Chicken",
      "Emmer wheat","Farina secalis cerealis","Ginkgo biloba",
      "Greens (Collard)","Lamb Liver","Liver - ox","Milkweed",
      "Onion","Pepper - green","Pheasant Gizzard","Pigeon",
      "Raisin","Skate","Soy Flour","Sweet Potato",
      "Tilefish","Winkles"
    ]
  }

};

function normalize(x){return x.trim().toLowerCase()}

function getReaction(item){
const i=normalize(item)
const cHigh=DATA.coco.high.some(x=>normalize(x)==i)
const cMod=DATA.coco.moderate.some(x=>normalize(x)==i)
const oHigh=DATA.ollie.high.some(x=>normalize(x)==i)
const oMod=DATA.ollie.moderate.some(x=>normalize(x)==i)

return{
coco:cHigh?"high":cMod?"moderate":"low",
ollie:oHigh?"high":oMod?"moderate":"low"
}
}

function showTab(id){
document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"))
document.querySelectorAll(".tab").forEach(t=>t.classList.add("hidden"))
document.querySelector(`[onclick="showTab('${id}')"]`).classList.add("active")
document.getElementById(id).classList.remove("hidden")
}
   <script>

/* ================================
   MASTER REACTIVITY DATA
================================ */

// COCO
const cocoHigh = [
"Canola Oil","Chia Seeds","Clove","Haddock","Herring","Mozzarella","Paprika",
"Peach","Rabbit","Rabbit Heart","Rabbit Liver","Rapeseed oil","Sugar (brown)",
"Sweet Potato","Tahini"
];

const cocoModerate = [
"Ammonium Laureth Sulfate","Beef","Bilberry","Cheese - Cheddar",
"Chlorella","Coconut","Cornflakes","Egg Yolk - Chicken","Egg Yolk - Duck",
"Hare","Iceberg lettuce","Lemon","Pecan nut","Pepper - green",
"Psyllium Seed Husk","Strawberry","Turnip","Winkles"
];

// OLLIE
const ollieHigh = [
"Avocado oil","Boar","Buttermilk","Canola Meal","Coconut","Coconut Oil",
"Crab","Duck Liver","Noodles - wheat","Papaya","Parmesan","Prawn",
"Sage","Strawberry","Tapioca","Venison Meal"
];

const ollieModerate = [
"Anchovy","Catfish","Cheese - Cottage","Chicken Heart","Condensed milk",
"Cream","Egg White - Chicken","Emmer wheat","Farina secalis cerealis",
"Ginkgo biloba","Greens (Collard)","Lamb Liver","Liver - ox","Milkweed",
"Onion","Pepper - green","Pheasant Gizzard","Pigeon","Raisin","Skate",
"Soy Flour","Sweet Potato","Tilefish","Winkles"
];

/* ================================
   BUILD MASTER LIST
================================ */

function buildMasterList() {
    const container = document.getElementById("masterListResults");
    container.innerHTML = "";

    const combined = {};

    function addItems(items, dog, level) {
        items.forEach(item => {
            const key = item.toLowerCase();
            if (!combined[key]) {
                combined[key] = [];
            }
            combined[key].push({ dog, level });
        });
    }

    addItems(cocoHigh, "Coco", "High");
    addItems(cocoModerate, "Coco", "Moderate");
    addItems(ollieHigh, "Ollie", "High");
    addItems(ollieModerate, "Ollie", "Moderate");

    Object.keys(combined).sort().forEach(item => {
        const div = document.createElement("div");

        const reactions = combined[item].map(r =>
            `${r.dog} (${r.level})`
        ).join(" • ");

        div.innerHTML = `
            <span class="${combined[item].some(r=>r.level==="High") ? "high" : "moderate"}">
                ${capitalize(item)} — ${reactions}
            </span>
        `;

        container.appendChild(div);
    });
}

function capitalize(str) {
    return str.replace(/\b\w/g, l => l.toUpperCase());
}

/* ================================
   SEARCH MASTER LIST
================================ */

function filterMasterList() {
    const input = document.getElementById("masterSearch").value.toLowerCase();
    const items = document.querySelectorAll("#masterListResults div");

    items.forEach(div => {
        div.style.display = div.innerText.toLowerCase().includes(input)
            ? "block"
            : "none";
    });
}

</script>
/* ================================
   BUILD BANNED LIST (FIXED)
================================ */

function buildBannedList() {
    const banned = new Set();

    Object.values(DATA).forEach(dog => {
        [...dog.high, ...dog.moderate].forEach(item => {
            banned.add(item.toLowerCase());
        });
    });

    return banned;
}

const bannedIngredients = buildBannedList();

/* ================================
   SAFE INGREDIENT LIBRARY
================================ */

const LIBRARY = {
    proteins: [
        "Chicken","Turkey","Salmon","Whitefish",
        "Lamb","Beef","Pork","Rabbit","Venison","Goat"
    ],
    carbs: [
        "White Rice","Brown Rice","Quinoa",
        "Oats","Barley","Sweet Potato","Potato","Millet"
    ],
    veggies: [
        "Carrot","Pumpkin","Zucchini","Spinach",
        "Broccoli","Green Beans","Butternut Squash","Peas"
    ],
    fats: [
        "Olive Oil","Salmon Oil","Sunflower Oil",
        "Beef Tallow","Chicken Fat"
    ],
    flavors: [
        "Pumpkin Puree","Bone Broth","Parsley",
        "Blueberries","Apple","Peanut Butter"
    ]
};

/* ================================
   FILTER SAFE INGREDIENTS
================================ */

function filterSafe(list) {
    return list.filter(item =>
        !bannedIngredients.has(item.toLowerCase())
    );
}

function getSafePools(){
    return {
        proteins: filterSafe(LIBRARY.proteins),
        carbs: filterSafe(LIBRARY.carbs),
        veggies: filterSafe(LIBRARY.veggies),
        fats: filterSafe(LIBRARY.fats),
        flavors: filterSafe(LIBRARY.flavors)
    };
}

/* ================================
   UNIT CONVERSIONS
================================ */

function lbsToOz(l){ return l * 16; }
function ozToLbs(o){ return o / 16; }
function ozToCups(o){ return o / 4; }

/* ================================
   GENERATE MEAL
================================ */

function generateMealPlan(){

    const cocoWeight = parseFloat(document.getElementById("cocoWeight").value);
    const ollieWeight = parseFloat(document.getElementById("ollieWeight").value);
    const feedPct = parseFloat(document.getElementById("feedPct").value) / 100;
    const mealsPerDay = parseInt(document.getElementById("mealsPerDay").value);
    const batchDays = parseInt(document.getElementById("batchDays").value);

    const cocoDailyOz = lbsToOz(cocoWeight * feedPct);
    const ollieDailyOz = lbsToOz(ollieWeight * feedPct);
    const totalDailyOz = cocoDailyOz + ollieDailyOz;

    const pools = getSafePools();

    if(
        !pools.proteins.length ||
        !pools.carbs.length ||
        !pools.veggies.length
    ){
        alert("No safe ingredients available in one or more categories.");
        return;
    }

    const rand = arr => arr[Math.floor(Math.random()*arr.length)];

    const protein = rand(pools.proteins);
    const carb = rand(pools.carbs);
    const veg = rand(pools.veggies);
    const fat = rand(pools.fats);
    const flavor = pools.flavors.length ? rand(pools.flavors) : "None";

    const batchTotalOz = totalDailyOz * batchDays;

    const output = `
    <div class="card">
        <h3>Suggested Shared Meal</h3>

        <p><strong>Protein:</strong> ${protein}</p>
        <p><strong>Carb:</strong> ${carb}</p>
        <p><strong>Vegetable:</strong> ${veg}</p>
        <p><strong>Fat:</strong> ${fat}</p>
        <p><strong>Flavor Boost:</strong> ${flavor}</p>

        <div class="sep"></div>

        <strong>Coco:</strong> ${cocoDailyOz.toFixed(2)} oz/day 
        (~${ozToCups(cocoDailyOz).toFixed(2)} cups)<br>
        Per meal: ${(cocoDailyOz/mealsPerDay).toFixed(2)} oz 
        (~${ozToCups(cocoDailyOz/mealsPerDay).toFixed(2)} cups)<br><br>

        <strong>Ollie:</strong> ${ollieDailyOz.toFixed(2)} oz/day 
        (~${ozToCups(ollieDailyOz).toFixed(2)} cups)<br>
        Per meal: ${(ollieDailyOz/mealsPerDay).toFixed(2)} oz 
        (~${ozToCups(ollieDailyOz/mealsPerDay).toFixed(2)} cups)<br>

        <div class="sep"></div>

        <strong>Total Batch (${batchDays} days):</strong><br>
        ${batchTotalOz.toFixed(2)} oz<br>
        ${ozToLbs(batchTotalOz).toFixed(2)} lbs<br>
        ~${ozToCups(batchTotalOz).toFixed(2)} cups<br>

        <div class="sep"></div>

        <button onclick="exportGrocery('${protein}','${carb}','${veg}','${fat}','${flavor}',${batchTotalOz})">
        Export Grocery List
        </button>
    </div>
    `;

    document.getElementById("mealOutput").innerHTML = output;
}

/* ================================
   EXPORT GROCERY LIST
================================ */

function exportGrocery(protein, carb, veg, fat, flavor, totalOz){

    const text = `
GROCERY LIST

Protein: ${protein}
Carb: ${carb}
Vegetable: ${veg}
Fat: ${fat}
Flavor Boost: ${flavor}

Total Food Needed:
${totalOz.toFixed(2)} oz
${ozToLbs(totalOz).toFixed(2)} lbs
~${ozToCups(totalOz).toFixed(2)} cups
`;

    const blob = new Blob([text], {type:"text/plain"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "grocery-list.txt";
    link.click();
}
